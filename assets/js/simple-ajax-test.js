(function($) {
    'use strict';

    $(document).ready(function() {
        const $testButton = $('#ps-simple-ajax-test-button');
        const $resultsDiv = $('#ps-simple-ajax-test-results');

        $testButton.on('click', function() {
            $resultsDiv.html('Loading...');

            const dataToSend = {
                action: psSimpleTestData.test_action, // Make sure this matches the PHP action hook
                nonce: psSimpleTestData.nonce,      // The nonce generated by PHP
                test_payload: 'Hello from the simple AJAX test! It is ' + new Date().toLocaleTimeString()
            };

            console.log('Sending AJAX request:', dataToSend);
            console.log('AJAX URL:', psSimpleTestData.ajaxurl);
            console.log('Nonce:', psSimpleTestData.nonce);
            console.log('Action:', psSimpleTestData.test_action);

            $.post(psSimpleTestData.ajaxurl, dataToSend, function(response) {
                console.log('AJAX Success Response:', response);
                if (response.success) {
                    let resultHtml = '<strong>' + response.data.message + '</strong><br>';
                    resultHtml += 'Timestamp: ' + response.data.timestamp + '<br>';
                    resultHtml += 'Received Payload: ' + response.data.received_payload + '<br>';
                    resultHtml += 'Action Triggered: ' + response.data.action_triggered;
                    $resultsDiv.html(resultHtml);
                    alert('Simple AJAX Test: ' + response.data.message);
                } else {
                    let errorMessage = 'AJAX Error: Unknown issue.';
                    if (response.data && response.data.message) {
                        errorMessage = 'AJAX Error: ' + response.data.message;
                    } else if (typeof response.data === 'string') {
                        errorMessage = 'AJAX Error: ' + response.data;
                    }
                    $resultsDiv.html('<span style="color: red;">' + errorMessage + '</span>');
                    alert(errorMessage);
                    console.error('AJAX Error Data:', response.data);
                }
            }).fail(function(jqXHR, textStatus, errorThrown) {
                console.error('AJAX .fail() Response:', {
                    jqXHR: jqXHR,
                    textStatus: textStatus,
                    errorThrown: errorThrown,
                    responseText: jqXHR.responseText
                });
                let failMessage = 'AJAX Request Failed: ' + textStatus + ' - ' + errorThrown;
                if (jqXHR.responseText) {
                    failMessage += '<br>Server said: ' + jqXHR.responseText.substring(0, 200) + '...';
                }
                $resultsDiv.html('<span style="color: red;">' + failMessage + '</span>');
                alert('AJAX Request Failed. Check console for details. Status: ' + jqXHR.status);
            });
        });
    });
})(jQuery); 